# 西嘉家政平台 - 管理后台完整系统开发任务清单

## 📋 文档信息

| 项目 | 说明 |
|-----|------|
| **版本** | v2.0 |
| **更新日期** | 2026-01-11 |
| **文档状态** | 正式版 |
| **适用范围** | 管理后台、小程序、APP（开发中） |

---

## 🔄 v2.0 版本修订说明

| 修订点 | 修订内容 | 理由 |
|-------|---------|------|
| 新增预备阶段 | 环境隔离、错误处理规范、数据库审计 | 确保在现有项目基础上安全开发 |
| 第一阶段重构 | 先审计现有表，再设计增量更新 | 禁止推倒重来，兼容现有数据 |
| 新增数据脱敏 | 敏感信息动态脱敏机制 | 安全红线要求 |
| 新增敏感操作审计 | 记录查看明文信息的操作轨迹 | 安全合规 |
| 财务模块加固 | 二次身份验证流程 | 资金安全 |
| API多端适配 | 统一API设计，兼容小程序+APP | APP正在开发 |
| 编辑器技术方案 | JSON协议驱动，多端渲染 | 跨端一致性 |

---

## 🏗️ 系统架构

### 多端架构设计

```
                    ┌─────────────────────────────────────┐
                    │         管理后台 (Vue 3)             │
                    │    内容管理 / 可视化编辑器            │
                    └──────────────┬──────────────────────┘
                                   │ 发布 JSON Schema
                                   ▼
┌──────────────────────────────────────────────────────────────────┐
│                      统一 API 层 (Node.js)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 认证中间件   │  │ 权限中间件   │  │ 脱敏中间件   │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
│  ┌─────────────────────────────────────────────────┐            │
│  │              业务 API（多端统一）                  │            │
│  └─────────────────────────────────────────────────┘            │
└──────────────────────────────────────────────────────────────────┘
                                   │
          ┌────────────────────────┼────────────────────────┐
          ▼                        ▼                        ▼
   ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
   │  微信小程序   │          │  APP (开发中) │          │   H5 (预留)  │
   │  JSON渲染器  │          │  JSON渲染器  │          │  JSON渲染器  │
   └─────────────┘          └─────────────┘          └─────────────┘
```

### 权限层级设计

```
超级管理员（Super Admin）
    │
    ├── 运营管理员（Operations）── 内容管理、活动管理、客户服务
    │
    ├── 业务管理员（Business）── 订单管理、家政员管理、服务管理
    │
    ├── 财务管理员（Finance）── 财务报表、结算管理、提现审核 [需二次验证]
    │
    ├── 客服专员（Customer Service）── 客户咨询、投诉处理、仲裁
    │
    └── 普通员工（Staff）── 只读权限、基础操作
```

---

## 📌 预备阶段：项目基础设施（第1-2天）[修订]

> **[修订理由]** 原清单直接从建表开始，忽略了现有项目的兼容性。新增预备阶段确保在现有基础上安全开发。

### 任务0.1 开发环境与生产环境隔离 [新增]
- [ ] 创建 `.env.development` 和 `.env.production` 配置文件
- [ ] 配置数据库连接（开发库/生产库分离）
- [ ] 配置API域名切换机制
- [ ] 配置日志输出级别（开发详细/生产精简）
- [ ] 创建环境检测脚本，防止误操作生产环境

**交付物**：
```
backend/
├── .env.development    # 开发环境配置
├── .env.production     # 生产环境配置
├── .env.example        # 配置模板
└── config/
    └── env.js          # 环境变量加载器
```

### 任务0.2 统一错误处理规范 [新增]
- [ ] 定义错误码体系（业务错误、系统错误、权限错误）
- [ ] 创建统一错误响应格式
- [ ] 创建全局错误捕获中间件
- [ ] 创建前端错误处理工具类
- [ ] 编写错误排查指南文档

**错误码设计**：
```javascript
// 错误码规范
{
  // 成功
  "SUCCESS": 0,
  
  // 客户端错误 1xxx
  "PARAM_ERROR": 1001,        // 参数错误
  "AUTH_FAILED": 1002,        // 认证失败
  "PERMISSION_DENIED": 1003,  // 权限不足
  "RESOURCE_NOT_FOUND": 1004, // 资源不存在
  
  // 业务错误 2xxx
  "ORDER_STATUS_ERROR": 2001, // 订单状态错误
  "BALANCE_NOT_ENOUGH": 2002, // 余额不足
  "WORKER_NOT_AVAILABLE": 2003, // 家政员不可用
  
  // 系统错误 5xxx
  "SYSTEM_ERROR": 5000,       // 系统错误
  "DB_ERROR": 5001,           // 数据库错误
  "THIRD_PARTY_ERROR": 5002   // 第三方服务错误
}

// 统一响应格式
{
  "success": false,
  "code": 1001,
  "message": "手机号格式不正确",
  "data": null,
  "timestamp": 1704931200000,
  "traceId": "req_abc123"  // 用于日志追踪
}
```

### 任务0.3 现有数据库审计与文档化 [新增]
- [ ] 导出现有数据库所有表结构
- [ ] 分析现有表的字段、索引、外键关系
- [ ] 记录现有表与业务的映射关系
- [ ] 识别需要扩展的表和字段
- [ ] 输出《现有数据库结构文档》

**执行命令**（你需要提供）：
```sql
-- 导出所有表结构
SHOW TABLES;
-- 逐个查看表结构
DESCRIBE users;
DESCRIBE workers;
DESCRIBE orders;
-- ... 其他表
```

---

## 📌 第一阶段：权限系统基础（第3-6天）[修订]

> **[修订理由]** 原方案是新建权限表，现改为在现有表基础上做增量扩展，并增加数据脱敏和敏感操作审计。

### 任务1.1 数据库增量设计 - 权限相关 [修订]
- [ ] **审计现有 users 表**，确定与 admin_users 的关联方式
- [ ] 设计 `admin_users` 表（管理员账号，关联现有用户体系）
- [ ] 设计 `admin_roles` 表（角色定义）
- [ ] 设计 `admin_permissions` 表（权限定义）
- [ ] 设计 `admin_role_permissions` 表（角色-权限关联）
- [ ] 设计 `admin_user_roles` 表（用户-角色关联）
- [ ] 设计 `admin_operation_logs` 表（操作日志）
- [ ] **[新增]** 设计 `admin_sensitive_logs` 表（敏感操作审计日志）
- [ ] 编写增量 SQL 脚本（ALTER TABLE / CREATE TABLE）
- [ ] 创建数据库迁移版本管理

**admin_users 与现有 users 关联设计**：
```sql
-- 方案A：独立账号体系（推荐）
CREATE TABLE admin_users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,      -- 登录账号
  password_hash VARCHAR(255) NOT NULL,
  real_name VARCHAR(50),
  phone VARCHAR(20),
  email VARCHAR(100),
  avatar VARCHAR(255),
  bindUserId INT DEFAULT NULL,               -- 关联现有users表（可选）
  bindWorkerId INT DEFAULT NULL,             -- 关联现有workers表（可选）
  status ENUM('active', 'disabled') DEFAULT 'active',
  last_login_at DATETIME,
  last_login_ip VARCHAR(50),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (bindUserId) REFERENCES users(id),
  FOREIGN KEY (bindWorkerId) REFERENCES workers(id)
);

-- 敏感操作审计日志 [新增]
CREATE TABLE admin_sensitive_logs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  admin_id INT NOT NULL,
  action_type ENUM('view_phone', 'view_idcard', 'view_address', 'export_data', 'modify_finance') NOT NULL,
  target_table VARCHAR(50),                  -- 操作的表
  target_id INT,                             -- 操作的记录ID
  data_accessed TEXT,                        -- 访问的敏感字段（脱敏记录）
  ip_address VARCHAR(50),
  user_agent VARCHAR(255),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_admin_action (admin_id, action_type, created_at)
);
```

### 任务1.2 数据脱敏机制设计 [新增]
- [ ] 定义敏感字段清单（手机号、身份证、住址、银行卡等）
- [ ] 设计脱敏规则（不同字段不同脱敏方式）
- [ ] 创建脱敏工具类（后端）
- [ ] 创建脱敏中间件（根据权限动态脱敏）
- [ ] 设计"查看明文"接口（需记录审计日志）

**脱敏规则设计**：
```javascript
// 脱敏规则配置
const MASK_RULES = {
  phone: {
    // 138****8000
    pattern: (val) => val.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2'),
    viewPermission: 'sensitive:phone:view'
  },
  idCard: {
    // 310***********1234
    pattern: (val) => val.replace(/(\d{3})\d{11}(\d{4})/, '$1***********$2'),
    viewPermission: 'sensitive:idcard:view'
  },
  address: {
    // 上海市浦东新区***
    pattern: (val) => val.substring(0, 9) + '***',
    viewPermission: 'sensitive:address:view'
  },
  bankCard: {
    // **** **** **** 1234
    pattern: (val) => '**** **** **** ' + val.slice(-4),
    viewPermission: 'sensitive:bankcard:view'
  },
  realName: {
    // 张*
    pattern: (val) => val.charAt(0) + '*'.repeat(val.length - 1),
    viewPermission: 'sensitive:name:view'
  }
};
```

### 任务1.3 后端 - 权限中间件开发 [修订]
- [ ] JWT Token 认证中间件（复用/改造现有）
- [ ] 权限验证中间件（RBAC）
- [ ] **[新增]** 数据脱敏中间件
- [ ] **[新增]** 敏感操作拦截中间件
- [ ] 操作日志中间件
- [ ] 登录/登出接口（支持多端）
- [ ] 密码加密/重置接口
- [ ] **[新增]** 二次验证接口（用于敏感操作）

**中间件执行顺序**：
```
请求 → JWT认证 → 权限验证 → 敏感操作拦截 → 业务处理 → 数据脱敏 → 响应
```

### 任务1.4 后端 - 系统管理API [修订]
- [ ] 管理员登录/登出（支持记住登录）
- [ ] 管理员 CRUD 接口（关联现有用户）
- [ ] 角色 CRUD 接口
- [ ] 权限树查询接口
- [ ] 角色权限配置接口
- [ ] 操作日志查询接口
- [ ] **[新增]** 敏感操作审计日志查询接口
- [ ] **[新增]** 查看明文接口（带审计记录）

---

## 📌 第二阶段：管理后台框架（第7-10天）

### 任务2.1 后台框架搭建
- [ ] Vue 3 + Element Plus + Vite 项目初始化
- [ ] 路由配置（动态路由，根据权限生成）
- [ ] Pinia 状态管理
- [ ] Axios 请求封装（统一错误处理）
- [ ] 权限指令封装（v-permission）
- [ ] **[新增]** 脱敏显示组件（SensitiveText）
- [ ] **[新增]** 查看明文按钮组件（带二次确认）

### 任务2.2 登录与布局
- [ ] 登录页面（账号密码 + 验证码）
- [ ] **[新增]** 二次验证弹窗组件
- [ ] 主布局框架（侧边栏+顶栏+内容区）
- [ ] 动态菜单渲染（根据权限）
- [ ] 面包屑导航
- [ ] 标签页切换
- [ ] 全屏切换
- [ ] 主题切换（可选）

### 任务2.3 系统管理页面
- [ ] 管理员列表（增删改查、关联用户）
- [ ] 管理员详情/编辑
- [ ] 角色列表
- [ ] 角色权限配置（树形勾选）
- [ ] 操作日志列表（支持筛选导出）
- [ ] **[新增]** 敏感操作审计日志页面

### 任务2.4 个人中心
- [ ] 个人信息修改
- [ ] 密码修改
- [ ] **[新增]** 操作密码设置（用于二次验证）
- [ ] 登录设备管理

---

## 📌 第三阶段：业务管理模块（第11-18天）[修订]

> **[修订理由]** 增加多端API适配设计、财务操作二次验证、数据脱敏展示。

### 任务3.1 API多端适配规范 [新增]
- [ ] 定义统一API响应格式
- [ ] 定义分页参数规范
- [ ] 定义筛选/排序参数规范
- [ ] 定义文件上传规范
- [ ] 编写API版本管理策略（v1/v2）
- [ ] 编写《API设计规范文档》

**API规范示例**：
```javascript
// 统一分页请求
GET /api/v1/orders?page=1&pageSize=20&status=pending&sort=-created_at

// 统一响应格式
{
  "success": true,
  "code": 0,
  "data": {
    "list": [...],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "totalPages": 5
    }
  }
}

// 多端标识
Header: X-Platform: miniprogram | app | admin
Header: X-App-Version: 1.0.0
```

### 任务3.2 客户管理
- [ ] 客户列表（搜索、筛选、导出）
- [ ] 客户详情页（**手机号、地址脱敏展示**）
- [ ] **[新增]** 查看客户明文信息（需权限+审计）
- [ ] 客户订单记录
- [ ] 客户标签管理
- [ ] 会员等级管理
- [ ] 黑名单管理

### 任务3.3 家政员管理
- [ ] 家政员列表（**身份证、手机号脱敏**）
- [ ] 入驻申请审核
- [ ] 家政员详情/编辑
- [ ] **[新增]** 查看家政员证件明文（需权限+审计）
- [ ] 资质证书管理
- [ ] 服务评价管理
- [ ] 推荐/置顶设置
- [ ] 家政员统计
- [ ] **[新增]** 家政员状态批量操作

### 任务3.4 服务管理（多端API适配）[修订]
- [ ] 服务分类管理
- [ ] 服务项目 CRUD
- [ ] 服务详情编辑（富文本）
- [ ] 价格配置（时段、区域差异化）
- [ ] 服务区域管理
- [ ] 服务上下架
- [ ] **[新增]** 服务API多端适配（小程序/APP统一）
- [ ] **[新增]** 服务数据缓存策略

### 任务3.5 订单管理（多端API适配）[修订]
- [ ] 订单列表（多条件筛选，**客户信息脱敏**）
- [ ] 订单详情页
- [ ] 订单状态流转
- [ ] 订单分配
- [ ] 退款处理
- [ ] 订单导出
- [ ] **[新增]** 订单API多端适配（状态推送统一）

### 任务3.6 仲裁管理
- [ ] 仲裁申请列表
- [ ] 仲裁详情页（**涉及双方信息脱敏**）
- [ ] 仲裁处理（判定、赔偿）
- [ ] 申诉管理
- [ ] 处罚记录
- [ ] 仲裁统计
- [ ] **[新增]** 仲裁处理需二次验证

### 任务3.7 财务管理 [修订]
- [ ] 收入概览
- [ ] 订单结算列表
- [ ] 家政员提现审核（**银行卡脱敏**）
- [ ] **[新增]** 提现审核二次身份验证
- [ ] **[新增]** 退款操作二次身份验证
- [ ] 平台分成配置
- [ ] 财务报表
- [ ] 对账管理
- [ ] **[新增]** 财务操作审计日志

**二次验证流程**：
```
操作员点击"确认提现" 
    → 弹出二次验证窗口 
    → 输入操作密码 / 扫码验证 
    → 验证通过 
    → 记录审计日志 
    → 执行操作
```

---

## 📌 第四阶段：数据统计与报表（第19-21天）

### 任务4.1 数据看板
- [ ] 运营数据概览（今日/本周/本月）
- [ ] 实时订单监控
- [ ] 关键指标卡片
- [ ] 数据趋势图表（ECharts）

### 任务4.2 统计分析
- [ ] 用户增长分析
- [ ] 订单分析（时段、区域、类型）
- [ ] 收入分析
- [ ] 家政员绩效分析
- [ ] 服务热度分析

### 任务4.3 报表导出
- [ ] 订单报表导出（**导出需审计记录**）
- [ ] 财务报表导出（**需二次验证**）
- [ ] 用户报表导出（**敏感字段脱敏**）
- [ ] 自定义报表

---

## 📌 第五阶段：CMS内容管理（第22-25天）

### 任务5.1 数据库增量设计 - CMS相关
- [ ] 设计 `cms_pages` 表（页面配置）
- [ ] 设计 `cms_page_components` 表（页面组件）
- [ ] 设计 `cms_banners` 表（轮播图）
- [ ] 设计 `cms_announcements` 表（公告）
- [ ] 设计 `cms_activities` 表（活动）
- [ ] 设计 `cms_articles` 表（文章）
- [ ] 设计 `cms_materials` 表（素材库）
- [ ] 设计 `cms_component_templates` 表（组件模板）
- [ ] 编写增量 SQL 脚本

### 任务5.2 素材库管理
- [ ] 图片上传/管理
- [ ] 图片分组/标签
- [ ] 图片压缩处理
- [ ] 素材搜索

### 任务5.3 轮播图管理
- [ ] 轮播图列表
- [ ] 添加/编辑轮播图
- [ ] 拖拽排序
- [ ] 定时上下线
- [ ] **[新增]** 多端预览（小程序/APP）

### 任务5.4 公告/活动/文章管理
- [ ] 公告列表与发布
- [ ] 活动创建与管理
- [ ] 文章分类与编辑
- [ ] 富文本编辑器集成

---

## 📌 第六阶段：可视化页面编辑器（第26-35天）[重大修订]

> **[修订理由]** 原方案是简单拖拽预览，现改为"JSON协议驱动"方案，确保多端渲染一致性。

### 技术方案概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    可视化编辑器 (Vue 3)                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  组件面板    │  │   画布区域   │  │  属性面板    │             │
│  │  (拖拽源)   │  │  (预览渲染)  │  │  (配置项)   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└───────────────────────────┬─────────────────────────────────────┘
                            │ 生成/编辑
                            ▼
              ┌─────────────────────────────┐
              │     JSON Schema 协议        │
              │  (统一页面描述格式)          │
              └─────────────────────────────┘
                            │ 存储到数据库
                            ▼
              ┌─────────────────────────────┐
              │      CMS API 服务           │
              │  GET /api/cms/page/{id}     │
              └─────────────────────────────┘
                            │ 分发到各端
          ┌─────────────────┼─────────────────┐
          ▼                 ▼                 ▼
   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
   │  小程序端    │   │   APP端     │   │   H5端     │
   │ JSON渲染器  │   │ JSON渲染器  │   │ JSON渲染器  │
   │ (原生组件)  │   │(Flutter/RN) │   │  (Vue/React)│
   └─────────────┘   └─────────────┘   └─────────────┘
```

### 任务6.1 JSON Schema 协议设计 [新增]
- [ ] 定义页面结构协议（Page Schema）
- [ ] 定义组件结构协议（Component Schema）
- [ ] 定义样式协议（Style Schema）
- [ ] 定义事件/动作协议（Action Schema）
- [ ] 定义数据绑定协议（DataBinding Schema）
- [ ] 编写《JSON Schema 协议规范文档》
- [ ] 创建协议验证工具（JSON Schema Validator）

**JSON Schema 示例**：
```json
{
  "version": "1.0",
  "pageId": "home",
  "pageName": "首页",
  "backgroundColor": "#F5F5F5",
  "components": [
    {
      "id": "banner_001",
      "type": "banner",
      "props": {
        "autoplay": true,
        "interval": 3000,
        "indicatorDots": true,
        "items": [
          {
            "imageUrl": "https://xxx/banner1.jpg",
            "linkType": "page",
            "linkValue": "/pages/activity/detail?id=1"
          }
        ]
      },
      "style": {
        "height": 360,
        "marginBottom": 20
      }
    },
    {
      "id": "service_grid_001",
      "type": "serviceGrid",
      "props": {
        "columns": 4,
        "showTitle": true,
        "dataSource": "api",
        "apiUrl": "/api/services/categories"
      },
      "style": {
        "backgroundColor": "#FFFFFF",
        "padding": [20, 16],
        "borderRadius": 12
      }
    },
    {
      "id": "worker_list_001",
      "type": "workerRecommend",
      "props": {
        "title": "推荐家政员",
        "showMore": true,
        "limit": 4,
        "layout": "horizontal"
      },
      "style": {
        "marginTop": 20
      }
    }
  ]
}
```

### 任务6.2 组件协议定义 [新增]
- [ ] 基础组件协议（图片、文本、按钮、分割线）
- [ ] 布局组件协议（容器、宫格、列表）
- [ ] 业务组件协议（轮播图、服务分类、家政员卡片）
- [ ] 交互组件协议（搜索框、Tab切换、公告栏）
- [ ] 营销组件协议（优惠券、倒计时、活动入口）
- [ ] 为每个组件定义 Props Schema
- [ ] 为每个组件定义 Style Schema

**组件协议示例**：
```javascript
// 组件类型定义
const ComponentTypes = {
  // 基础组件
  'image': { name: '图片', category: 'basic' },
  'text': { name: '文本', category: 'basic' },
  'button': { name: '按钮', category: 'basic' },
  'divider': { name: '分割线', category: 'basic' },
  
  // 布局组件
  'container': { name: '容器', category: 'layout' },
  'grid': { name: '宫格', category: 'layout' },
  
  // 业务组件
  'banner': { name: '轮播图', category: 'business' },
  'serviceGrid': { name: '服务分类', category: 'business' },
  'serviceCard': { name: '服务卡片', category: 'business' },
  'workerRecommend': { name: '推荐家政员', category: 'business' },
  'announcement': { name: '公告栏', category: 'business' },
  
  // 营销组件
  'coupon': { name: '优惠券', category: 'marketing' },
  'countdown': { name: '倒计时', category: 'marketing' }
};

// 单个组件 Props Schema 示例
const BannerPropsSchema = {
  type: 'object',
  properties: {
    autoplay: { type: 'boolean', default: true, title: '自动播放' },
    interval: { type: 'number', default: 3000, title: '切换间隔(ms)' },
    indicatorDots: { type: 'boolean', default: true, title: '显示指示点' },
    indicatorColor: { type: 'string', default: 'rgba(0,0,0,0.3)', title: '指示点颜色' },
    indicatorActiveColor: { type: 'string', default: '#1890FF', title: '当前指示点颜色' },
    items: {
      type: 'array',
      title: '轮播项',
      items: {
        type: 'object',
        properties: {
          imageUrl: { type: 'string', title: '图片地址' },
          linkType: { type: 'string', enum: ['page', 'webview', 'none'], title: '跳转类型' },
          linkValue: { type: 'string', title: '跳转地址' }
        }
      }
    }
  }
};
```

### 任务6.3 编辑器框架开发
- [ ] 左侧组件面板（分类展示、可拖拽）
- [ ] 中间画布区域（实时渲染预览）
- [ ] 右侧属性面板（根据组件Schema动态生成表单）
- [ ] 顶部工具栏（保存、预览、发布、历史）
- [ ] 组件拖拽排序（vue-draggable）
- [ ] 组件选中/删除/复制
- [ ] 撤销/重做功能（Undo/Redo Stack）

### 任务6.4 属性面板开发
- [ ] 根据 Props Schema 动态生成表单
- [ ] 基础表单控件（输入框、选择器、开关）
- [ ] 颜色选择器
- [ ] 图片选择器（对接素材库）
- [ ] 链接选择器（页面/小程序/H5）
- [ ] 数据源配置器（静态/API）
- [ ] 样式编辑器（间距、圆角、背景）

### 任务6.5 预览功能
- [ ] 编辑器内实时预览（Vue组件渲染）
- [ ] 手机模拟器预览（iframe + 真实渲染）
- [ ] **[新增]** 多端预览切换（小程序/APP/H5模式）
- [ ] 二维码预览（真机扫码预览）

### 任务6.6 页面发布与版本管理
- [ ] 保存草稿
- [ ] 发布上线
- [ ] 版本历史列表
- [ ] 版本回滚
- [ ] 定时发布（可选）

### 任务6.7 现有小程序UI适配 [新增]
- [ ] 分析现有小程序组件样式
- [ ] 创建样式映射表（编辑器样式 → 小程序样式）
- [ ] 确保编辑器预览与小程序渲染一致
- [ ] 处理平台差异（如小程序特有单位rpx）

### 任务6.8 小程序端 JSON 渲染器
- [ ] 创建页面渲染容器组件
- [ ] 实现组件动态加载机制
- [ ] 实现各组件的小程序版本
- [ ] 样式计算与适配（rpx转换）
- [ ] 数据获取与绑定
- [ ] 事件处理与页面跳转

### 任务6.9 APP端渲染器预留 [新增]
- [ ] 输出《APP端JSON渲染器开发规范》
- [ ] 定义APP端组件接口规范
- [ ] 提供Flutter/RN组件开发示例
- [ ] 预留APP端样式适配方案

---

## 📌 第七阶段：系统配置与上线（第36-40天）

### 任务7.1 系统配置页面
- [ ] 平台基础信息配置
- [ ] 支付配置（微信支付参数）
- [ ] 短信配置
- [ ] 小程序配置
- [ ] APP配置预留
- [ ] 客服配置

### 任务7.2 安全加固
- [ ] 登录失败次数限制
- [ ] IP白名单配置
- [ ] 敏感操作二次验证完善
- [ ] 数据备份配置
- [ ] 安全审计报告生成

### 任务7.3 性能优化
- [ ] 接口缓存（Redis）
- [ ] 图片CDN配置
- [ ] 数据库索引优化
- [ ] 前端打包优化
- [ ] 接口压力测试

### 任务7.4 测试与上线
- [ ] 功能测试清单
- [ ] 权限测试清单
- [ ] 安全测试（渗透测试基础项）
- [ ] 部署上线
- [ ] 监控告警配置

### 任务7.5 文档与培训
- [ ] 管理员操作手册
- [ ] API接口文档
- [ ] 数据库设计文档
- [ ] 故障排查指南

---

## 🔐 权限矩阵（更新版）

| 功能模块 | 超级管理员 | 运营管理员 | 业务管理员 | 财务管理员 | 客服专员 |
|---------|:--------:|:--------:|:--------:|:--------:|:------:|
| 员工管理 | ✅ 全部 | ❌ | ❌ | ❌ | ❌ |
| 角色权限 | ✅ 全部 | ❌ | ❌ | ❌ | ❌ |
| 操作日志 | ✅ 全部 | 👁️ 查看 | 👁️ 查看 | 👁️ 查看 | ❌ |
| **敏感审计** | ✅ 全部 | ❌ | ❌ | 👁️ 查看 | ❌ |
| 客户管理 | ✅ 全部 | ✅ 全部 | 👁️ 脱敏 | 👁️ 脱敏 | ✅ 全部 |
| **查看客户明文** | ✅ | ✅ | ❌ | ❌ | ✅+审计 |
| 家政员管理 | ✅ 全部 | ✅ 全部 | ✅ 全部 | 👁️ 脱敏 | 👁️ 脱敏 |
| **查看证件明文** | ✅ | ✅ | ✅+审计 | ❌ | ❌ |
| 服务管理 | ✅ 全部 | ✅ 全部 | ✅ 全部 | ❌ | ❌ |
| 订单管理 | ✅ 全部 | 👁️ 查看 | ✅ 全部 | ✅ 全部 | 👁️ 脱敏 |
| 仲裁管理 | ✅ 全部 | ✅ 全部 | 👁️ 查看 | ❌ | ✅ 全部 |
| **退款操作** | ✅+二验 | ❌ | ❌ | ✅+二验 | ❌ |
| 财务管理 | ✅ 全部 | 👁️ 查看 | ❌ | ✅ 全部 | ❌ |
| **提现审核** | ✅+二验 | ❌ | ❌ | ✅+二验 | ❌ |
| 数据统计 | ✅ 全部 | ✅ 全部 | ✅ 全部 | ✅ 全部 | 👁️ 部分 |
| **数据导出** | ✅+审计 | ✅+审计 | 👁️ 脱敏 | ✅+审计 | ❌ |
| CMS管理 | ✅ 全部 | ✅ 全部 | ❌ | ❌ | ❌ |
| 可视化编辑 | ✅ 全部 | ✅ 全部 | ❌ | ❌ | ❌ |
| 系统配置 | ✅ 全部 | ❌ | ❌ | ❌ | ❌ |

**图例**：
- ✅ 全部权限
- 👁️ 只读/脱敏数据
- ❌ 无权限
- +二验 需要二次身份验证
- +审计 操作记录审计日志

---

## 🎯 里程碑节点（更新版）

| 阶段 | 完成时间 | 交付物 | 关键验收点 |
|-----|---------|--------|-----------|
| 预备阶段 | 第2天 | 环境配置+数据库审计 | 开发环境可用 |
| 第一阶段 | 第6天 | 权限系统+脱敏机制 | 登录+权限验证通过 |
| 第二阶段 | 第10天 | 管理后台框架 | 框架可访问+菜单正常 |
| 第三阶段 | 第18天 | 业务管理模块 | 核心业务可操作 |
| 第四阶段 | 第21天 | 数据统计报表 | 看板数据正确 |
| 第五阶段 | 第25天 | CMS内容管理 | 轮播图可配置 |
| 第六阶段 | 第35天 | 可视化编辑器 | 首页可编辑发布 |
| 第七阶段 | 第40天 | 系统配置+上线 | 全功能验收通过 |

---

## 📁 完整目录结构（更新版）

```
backend/
├── config/
│   ├── env.js                 # 环境变量加载
│   ├── database.js            # 数据库配置
│   └── constants.js           # 常量定义
├── middleware/
│   ├── auth.js                # JWT认证
│   ├── permission.js          # 权限验证
│   ├── dataMask.js            # [新增] 数据脱敏
│   ├── sensitiveLog.js        # [新增] 敏感操作审计
│   ├── secondVerify.js        # [新增] 二次验证
│   ├── operationLog.js        # 操作日志
│   └── errorHandler.js        # [新增] 统一错误处理
├── utils/
│   ├── response.js            # [新增] 统一响应
│   ├── errorCodes.js          # [新增] 错误码定义
│   ├── maskUtils.js           # [新增] 脱敏工具
│   └── validator.js           # 参数验证
├── routes/
│   └── admin/
│       ├── auth.js            # 登录认证
│       ├── user.js            # 员工管理
│       ├── role.js            # 角色管理
│       ├── customer.js        # 客户管理
│       ├── worker.js          # 家政员管理
│       ├── service.js         # 服务管理
│       ├── order.js           # 订单管理
│       ├── arbitration.js     # 仲裁管理
│       ├── finance.js         # 财务管理
│       ├── stats.js           # 数据统计
│       ├── cms.js             # CMS管理
│       ├── page.js            # [新增] 页面配置
│       └── config.js          # 系统配置
├── migrations/                 # [新增] 数据库迁移
│   ├── 001_admin_system.sql
│   ├── 002_cms_tables.sql
│   └── ...
└── docs/                       # [新增] 文档
    ├── API.md
    ├── DATABASE.md
    └── ERROR_CODES.md

admin/src/
├── api/                       # API接口
├── components/
│   ├── Permission/            # 权限组件
│   ├── SensitiveText/         # [新增] 脱敏显示组件
│   ├── SecondVerify/          # [新增] 二次验证组件
│   ├── Upload/                # 上传组件
│   └── ...
├── views/
│   ├── system/                # 系统管理
│   │   ├── user/
│   │   ├── role/
│   │   ├── log/
│   │   └── sensitiveLog/      # [新增] 敏感审计
│   ├── customer/              # 客户管理
│   ├── worker/                # 家政员管理
│   ├── service/               # 服务管理
│   ├── order/                 # 订单管理
│   ├── arbitration/           # 仲裁管理
│   ├── finance/               # 财务管理
│   ├── stats/                 # 数据统计
│   ├── cms/                   # CMS管理
│   └── editor/                # 可视化编辑器
│       ├── index.vue          # 编辑器主页
│       ├── components/        # 编辑器组件
│       │   ├── ComponentPanel.vue   # 组件面板
│       │   ├── Canvas.vue           # 画布
│       │   ├── PropertyPanel.vue    # 属性面板
│       │   └── Preview.vue          # 预览
│       ├── schemas/           # [新增] 组件Schema
│       └── renderer/          # [新增] 渲染器

miniprogram/
├── components/
│   └── cms-renderer/          # [新增] JSON渲染器
│       ├── index.js
│       ├── index.wxml
│       ├── components/        # 各组件实现
│       │   ├── banner/
│       │   ├── service-grid/
│       │   ├── worker-card/
│       │   └── ...
│       └── utils/
│           └── styleConverter.js  # rpx转换
└── pages/
    └── cms-page/              # [新增] 动态页面
```

---

## ⚡ 开始执行

**任务清单 v2.0 已完成，请确认后回复"开始"。**

**我将按以下顺序执行：**

1. ✅ 任务0.1 - 开发环境与生产环境隔离配置
2. ✅ 任务0.2 - 统一错误处理规范
3. ✅ 任务0.3 - 现有数据库审计（需要你提供表结构）
4. ...依次进行

**你也可以指定调整优先级或从特定任务开始！**
